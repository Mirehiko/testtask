function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var s=0;s<a.length;s++){var e=a[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,a,s){return a&&_defineProperties(t.prototype,a),s&&_defineProperties(t,s),t}var ID=function(){return"_".concat(Math.random().toString(36).substr(2,9))},Task=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getPage",value:function(t){var a="/api/gettasks/?page=".concat(t);sortParams&&(a+=sortParams),$.ajax({url:a,type:"GET",dataType:"json",success:function(t){drawTaskList(t.taskList),paginator.setData(t)}})}},{key:"create",value:function(a){$.ajax({url:"/api/createtask/",type:"POST",data:a,dataType:"json",success:function(a){taskCreateForm.clearFormData(),t.getPage(paginator.currentPage)}})}},{key:"update",value:function(a){console.log("before update",a),$.ajax({url:"/api/updatetask/",type:"POST",data:a,dataType:"json",success:function(a){"success"===a.status?t.getPage(paginator.currentPage):console.error(a)}})}}]),t}(),TaskForm=function(){function t(a){_classCallCheck(this,t),this.id=ID(),this.form=null,this.formTitle=null,this.formTaskUserName=null,this.formTaskEmail=null,this.formTaskTitle=null,this.formTaskDescription=null,this.closeBtn=null,this.confirmBtn=null,this.state="hidden",this.action=null,this.formName="Форма",this.confirmBtnText="Принять",this.init(a)}return _createClass(t,[{key:"init",value:function(t){var a=this;this.action=t.action,this.formName=t.formName,this.confirmBtnText=t.confirmBtnText,this.form=$(document.createElement("form")),this.form.addClass("taskForm"),this.formTitle=$(document.createElement("h2")),this.formTitle.addClass("taskTitle"),this.formTitle.text(this.formName),this.form.append(this.formTitle),this.formTaskTitle=$(document.createElement("input")),this.formTaskTitle.attr("type","text"),this.formTaskTitle.attr("name","title"),this.formTaskTitle.attr("placeholder","Имя задачи"),this.formTaskTitle.addClass("inputField"),this.formTaskDescription=$(document.createElement("textarea")),this.formTaskDescription.attr("type","text"),this.formTaskDescription.attr("name","description"),this.formTaskDescription.attr("placeholder","Описание"),this.formTaskDescription.addClass("inputField"),this.formTaskUserName=$(document.createElement("input")),this.formTaskUserName.attr("type","text"),this.formTaskUserName.attr("name","user"),this.formTaskUserName.attr("placeholder","ФИО"),this.formTaskUserName.addClass("inputField"),this.formTaskEmail=$(document.createElement("input")),this.formTaskEmail.attr("type","email"),this.formTaskEmail.attr("name","email"),this.formTaskEmail.attr("placeholder","Email"),this.formTaskEmail.addClass("inputField"),this.form.append(this.formTaskTitle),this.form.append(this.formTaskDescription),this.form.append(this.formTaskUserName),this.form.append(this.formTaskEmail),this.confirmBtn=$(document.createElement("button")),this.confirmBtn.attr("type","confirm"),this.confirmBtn.addClass("btn btnConfirm"),this.confirmBtn.text(this.confirmBtnText),this.form.append(this.confirmBtn),this.closeBtn=$(document.createElement("button")),this.closeBtn.attr("type","button"),this.closeBtn.addClass("btn btnClose"),this.closeBtn.append('<i class="fas fa-times"></i>'),this.form.append(this.closeBtn),this.confirmBtn.on("click",function(t){t.preventDefault(),null===a.data&&(a.data={});var s=a.data;s.user=a.formTaskUserName.val(),s.email=a.formTaskEmail.val(),s.title=a.formTaskTitle.val(),s.description=a.formTaskDescription.val(),console.log("prepare",s),a.action(s)}),this.closeBtn.on("click",function(){"visible"===a.state?a.close():a.show()})}},{key:"setFormData",value:function(t){this.data=t,console.log("formdata",this.data),this.formTaskTitle.val(t.title),this.formTaskDescription.val(t.description),this.formTaskUserName.val(t.user),this.formTaskEmail.val(t.email)}},{key:"clearFormData",value:function(){this.data=null,this.formTaskTitle.val(""),this.formTaskDescription.val(""),this.formTaskUserName.val(""),this.formTaskEmail.val("")}},{key:"show",value:function(){this.state="visible",this.form.attr("state",this.state)}},{key:"close",value:function(){this.state="hidden",this.form.attr("state",this.state),this.clearFormData()}}]),t}(),TaskForms=function(){function t(){_classCallCheck(this,t),this.forms={}}return _createClass(t,[{key:"add",value:function(t){this.forms[t.id]=t}},{key:"closeForms",value:function(){for(var t in this.forms)this.forms[t].close()}}]),t}(),TaskListView=function(){function t(a){_classCallCheck(this,t),this.updateData(a),this.state="closed",this.init()}return _createClass(t,[{key:"init",value:function(){var t=this;this.task=$(document.createElement("div")),this.task.attr("taskid",this.data.taskid),this.task.addClass("task"),this.data.is_cofirmed&&this.task.addClass("task-confirmed"),this.taskHeader=$(document.createElement("div")),this.taskHeader.addClass("taskHeader"),this.task.append(this.taskHeader),this.taskTitle=$(document.createElement("span")),this.taskTitle.addClass("taskHeader__item taskTitle"),this.taskHeader.append(this.taskTitle),this.taskUser=$(document.createElement("span")),this.taskUser.addClass("taskHeader__item taskUser"),this.taskHeader.append(this.taskUser),this.taskEmail=$(document.createElement("span")),this.taskEmail.addClass("taskHeader__item taskEmail"),this.taskHeader.append(this.taskEmail),this.taskStateToggler=$(document.createElement("button")),this.taskStateToggler.attr("type","button"),this.taskStateToggler.addClass("taskHeader__item taskStateToggler"),this.taskStateToggler.append('<i class="fas fa-chevron-down"></i>'),this.taskHeader.append(this.taskStateToggler),this.taskBody=$(document.createElement("div")),this.taskBody.addClass("taskBody"),this.task.append(this.taskBody),this.taskControls=$(document.createElement("div")),this.taskControls.addClass("taskControls"),this.taskBody.append(this.taskControls),this.taskDescription=$(document.createElement("div")),this.taskBody.append(this.taskDescription),this.taskConfirm=$(document.createElement("button")),this.taskConfirm.attr("type","button"),this.taskConfirm.attr("taskid",this.data.taskid),this.taskConfirm.addClass("btn taskConfirm"),this.taskConfirm.append('<i class="far fa-check-square"></i>'),this.data.is_cofirmed?this.taskConfirm.find("i").addClass("fa-check-square"):this.taskConfirm.find("i").addClass("fa-square"),this.taskControls.append(this.taskConfirm),this.taskEdit=$(document.createElement("button")),this.taskEdit.attr("type","button"),this.taskEdit.attr("taskid",this.data.taskid),this.taskEdit.addClass("btn taskEdit"),this.taskEdit.append('<i class="far fa-edit"></i>'),this.taskControls.append(this.taskEdit),this.fillFileds(),this.taskStateToggler.on("click",function(){"opened"===t.state?t.close():t.open()}),this.taskConfirm.on("click",function(){confirmTask.call(this)}),this.taskEdit.on("click",function(){taskForms.closeForms(),taskUpdateForm.clearFormData(),taskUpdateForm.setFormData(t.data),taskUpdateForm.show()})}},{key:"updateData",value:function(t){this.data=t}},{key:"fillFileds",value:function(){this.taskTitle.text(this.data.title),this.taskUser.text(this.data.user),this.taskEmail.append(this.data.email),this.taskDescription.text(this.data.description),this.data.is_cofirmed?(this.taskConfirm.find("i").removeClass("fa-square"),this.taskConfirm.find("i").addClass("fa-check-square")):(this.taskConfirm.find("i").removeClass("fa-check-square"),this.taskConfirm.find("i").addClass("fa-square"))}},{key:"open",value:function(){this.state="opened",this.task.addClass("task-opened")}},{key:"close",value:function(){this.state="closed",this.task.removeClass("task-opened")}}]),t}(),Paginator=function(){function t(){_classCallCheck(this,t),this.name="",this.nextPage=0,this.currentPage=0,this.prevPage=0,this.init()}return _createClass(t,[{key:"init",value:function(){var t=this;this.pagination=$(document.createElement("div")),this.pagination.addClass("taskControls pagination"),this.prevBtn=$(document.createElement("a")),this.prevBtn.attr("type","button"),this.prevBtn.addClass("btn taskControl pageControl js-goto"),this.prevBtn.append('<i class="fas fa-chevron-left"></i>'),this.pagination.append(this.prevBtn),this.current=$(document.createElement("span")),this.current.attr("type","button"),this.current.addClass("btn taskControl"),this.current.text(this.currentPage),this.pagination.append(this.current),this.nextBtn=$(document.createElement("a")),this.nextBtn.attr("type","button"),this.nextBtn.addClass("btn taskControl pageControl js-goto"),this.nextBtn.append('<i class="fas fa-chevron-right"></i>'),this.pagination.append(this.nextBtn),this.prevBtn.on("click",function(a){a.preventDefault(),Task.getPage(t.prevPage)}),this.nextBtn.on("click",function(a){a.preventDefault(),Task.getPage(t.nextPage)})}},{key:"setData",value:function(t){this.currentPage=t.page,this.nextPage=t.next,this.prevPage=t.prev,this.current.text(this.currentPage),this.draw()}},{key:"draw",value:function(){this.prevPage?this.prevBtn.attr("state","visible"):this.prevBtn.attr("state","hidden"),this.nextPage?this.nextBtn.attr("state","visible"):this.nextBtn.attr("state","hidden")}}]),t}();function fillTaskList(t){for(var a in taskList=[],t)taskList.push(new TaskListView(t[a]))}function drawTaskList(t){fillTaskList(t);var a=$(document.createDocumentFragment());for(var s in t)a.append(taskList[s].task);$(".taskList").empty(),$(".taskList").append(a)}function confirmTask(){var t=$(this).attr("taskid"),a=taskList.filter(function(a){return a.data.taskid==t});(a=a[0].data).is_cofirmed?a.is_cofirmed=!1:a.is_cofirmed=!0,Task.update(a)}var paginator=new Paginator;paginator.setData(toPage),$("#paginator").append(paginator.pagination);var taskCreateForm=new TaskForm({action:Task.create,formName:"Создать задачу",confirmBtnText:"Создать"}),taskUpdateForm=new TaskForm({action:Task.update,formName:"Редактирование",confirmBtnText:"Сохранить"}),taskActions=$("#taskActions");taskActions.append(taskCreateForm.form),taskActions.append(taskUpdateForm.form);var taskForms=new TaskForms;taskForms.add(taskCreateForm),taskForms.add(taskUpdateForm);var sortParams="";drawTaskList(taskList),$("#createTask").on("click",function(){taskForms.closeForms(),taskCreateForm.show()}),$(".sortItem").on("click",function(t){t.preventDefault(),$(".sortItem").removeClass("active"),$(this).addClass("active"),sortParams="&sortby=".concat($(this).attr("sortby"),"&sortkey=").concat($(this).attr("sortby")),Task.getPage(paginator.currentPage)});